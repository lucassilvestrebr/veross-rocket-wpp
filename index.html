<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rocketflow</title>
  <meta name="color-scheme" content="light only" />
  <style>
    :root{
      --navy: #080A30;
      --gold: #ae8a56;
      --sand: #ecd7b4;
      --gray: #cdcdd0;
      --paper: #fcfcfc;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 20% -10%, #cbd0ff33 0%, transparent 60%),
        radial-gradient(1200px 600px at 120% 10%, #f6e6cc55 0%, transparent 60%),
        var(--paper);
      color: #1a1a1a;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:24px;
    }
    header{
      width:100%;
      max-width:980px;
      padding:24px 16px 0;
      display:flex;
      align-items:center;
      gap:14px;
    }
    header img.logo{
      width:48px;height:48px;border-radius:12px;object-fit:contain;
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
    }
    header .title{
      display:flex;flex-direction:column;gap:4px
    }
    header .title h1{
      margin:0;font-weight:800;letter-spacing:.2px;color:var(--navy);font-size:22px;
    }
    header .title small{color:#475;text-wrap:balance}

    .card{
      width:min(920px, 96vw);
      background:white;
      border:1px solid #00000010;
      border-radius:18px;
      box-shadow:
        0 10px 30px -10px rgba(8,10,48,.20),
        0 4px 12px -6px rgba(8,10,48,.15),
        inset 0 1px 0 rgba(255,255,255,.6);
      padding:28px;
    }
    .card.narrow{width:min(720px, 96vw)}
    .divider{height:1px;background:linear-gradient(90deg, transparent, #00000010, transparent); margin:22px 0}
    h2{margin:14px 0 12px;font-size:20px;color:var(--navy)}
    label{display:block;margin:14px 0 8px;font-weight:600;color:#222}
    input[type="email"],input[type="password"],input[type="text"],textarea{
      width:100%;
      padding:14px 14px;
      border:1px solid #00000022;
      border-radius:12px;
      background:#fff;
      outline:none;
      font-size:16px;
      transition:.15s border, .15s box-shadow;
    }
    textarea{min-height:120px;resize:vertical}
    input:focus, textarea:focus{
      border-color:#3b82f622;
      box-shadow: 0 0 0 4px #3b82f611;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .actions{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:0;cursor:pointer;
      padding:12px 18px;border-radius:12px;font-weight:700;font-size:15px;
      box-shadow: 0 6px 18px -10px rgba(8,10,48,.4);
      transition:.15s transform, .15s filter, .15s opacity;
    }
    .btn:disabled{opacity:.55;filter:grayscale(.3);cursor:not-allowed}
    .btn-primary{background:var(--navy);color:#fff}
    .btn-gold{background:var(--gold);color:#fff}
    .btn-ghost{background:#f6f7fb;color:#222;border:1px solid #00000012}
    .muted{color:#666}
    .right{margin-left:auto}
    .footer{
      margin:10px 0 32px;color:#555;font-size:14px;text-align:center
    }
    .hint{font-size:12px;color:#666;margin-top:6px}
    .pwd-wrap{position:relative}
    .pwd-toggle{
      position:absolute;right:10px;top:50%;transform:translateY(-50%);
      border:0;background:#f3f4f8;padding:6px 10px;border-radius:10px;cursor:pointer;
      color:#333;font-weight:700
    }
    .tagline{text-align:center;color:#222;margin-top:6px}
    .hide{display:none !important}
    a.layout{color:var(--navy);text-decoration:none;border-bottom:1px dashed var(--navy)}
    @media (max-width:720px){ .row{grid-template-columns:1fr} }
  </style>
</head>
<body>

  <!-- topo -->
  <header>
    <img class="logo" src="https://i.postimg.cc/28y5rD7J/LOGO-VEROSS-ROCKETFLOW-1000-X1000.png" alt="Rocketflow logo" />
    <div class="title">
      <h1>Rocketflow</h1>
      <small class="muted">Faça prospecção todo santo dia!</small>
    </div>
  </header>

  <!-- LOGIN -->
  <section id="card-login" class="card narrow">
    <h2>Acesse sua conta</h2>

    <div class="row">
      <div>
        <label for="email">E-mail</label>
        <input id="email" type="email" placeholder="voce@empresa.com" autocomplete="email" />
      </div>
      <div class="pwd-wrap">
        <label for="senha">Senha</label>
        <input id="senha" type="password" placeholder="••••••••" autocomplete="current-password" />
        <button id="btnMostrar" class="pwd-toggle" type="button">Mostrar</button>
      </div>
    </div>

    <div class="actions" style="margin-top:14px">
      <button id="btnCriarConta" class="btn btn-gold" type="button">Criar conta</button>
      <button id="btnEntrar" class="btn btn-primary" type="button">Entrar</button>
      <span class="hint">Use o mesmo e-mail para criar e entrar.</span>
      <span class="right muted" id="loginStatus"></span>
    </div>

    <div class="divider"></div>
    <div class="hint">Dica: guarde bem sua senha 😉</div>
  </section>

  <!-- APP (aparece após login) -->
  <section id="card-app" class="card hide">
    <div class="row" style="align-items:center">
      <div>
        <h2>Campanha</h2>
        <div class="muted">Logado como <strong id="user-email">—</strong></div>
      </div>
      <div class="actions right">
        <button id="btnSair" class="btn btn-ghost" type="button">Sair</button>
      </div>
    </div>

    <label for="nomeCampanha">Nome da campanha</label>
    <input id="nomeCampanha" type="text" placeholder="Ex.: Abertura Setembro" />

    <label for="objetivoCampanha">Objetivo da campanha</label>
    <input id="objetivoCampanha" type="text" placeholder="Ex.: Geração de leads B2B" />

    <label for="mensagemCampanha">Mensagem da campanha</label>
    <textarea id="mensagemCampanha">Oi, [[nome]]! Aqui é da Veross 🚀 — posso te enviar uma ideia rápida?</textarea>
    <div class="hint">Use [[nome]] para personalizar com o nome da lista.</div>

    <div class="divider"></div>

    <div class="actions">
      <a class="layout" href="data:text/csv;charset=utf-8,nome,telefone%0A" download="layout_contatos.csv">Baixar layout (nome,telefone)</a>
      <span class="muted">A lista é lida da planilha padrão no Google Sheets.</span>
      <button id="btnIniciar" class="btn btn-primary right" type="button">Iniciar campanha</button>
    </div>
  </section>

  <div class="footer">
    Veross 🚀 B2Bzando | Utilize com responsabilidade.
  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- App script -->
  <script>
    // 🔐 Credenciais públicas do seu projeto (ANON)
    const SUPABASE_URL  = "https://zrsofdqppbvxzhiwnzzr.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpyc29mZHFwcGJ2eHpoaXduenpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1OTc5MjUsImV4cCI6MjA3MjE3MzkyNX0.LZNHtXsG5Thkf_6ZRG5-UfAMaIqzOHrSt5UgRsnEaTs";

    // Endpoints do n8n
    const N8N_OUTREACH = "https://webhook.veross.com.br/webhook/rocketflow-outreach";

    // Instância Supabase
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
      auth: { persistSession: true, autoRefreshToken: true }
    });

    // Helpers UI
    const $ = (sel) => document.querySelector(sel);
    const show = (el) => el.classList.remove('hide');
    const hide = (el) => el.classList.add('hide');

    async function refreshUI(){
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        hide($("#card-login"));
        show($("#card-app"));
        $("#user-email").textContent = session.user?.email || "-";
      } else {
        show($("#card-login"));
        hide($("#card-app"));
        $("#user-email").textContent = "-";
      }
    }

    // Ações de Auth
    async function criarConta(){
      disableDuring(async () => {
        const email = $("#email").value.trim();
        const password = $("#senha").value;
        const { error } = await supabase.auth.signUp({ email, password });
        if (error) return alert("Erro ao criar conta: " + error.message);
        alert("Conta criada! Caso exija confirmação, verifique seu e-mail.");
      }, $("#btnCriarConta"));
    }

    async function entrar(){
      disableDuring(async () => {
        const email = $("#email").value.trim();
        const password = $("#senha").value;
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) return alert("Login falhou: " + error.message);
        $("#loginStatus").textContent = "";
        await refreshUI();
      }, $("#btnEntrar"));
    }

    async function sair(){
      await supabase.auth.signOut();
      await refreshUI();
    }

    // Disparo
    async function iniciarCampanha(){
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) return alert("Faça login primeiro.");

      const payload = {
        nome: ($("#nomeCampanha").value || "").trim() || "Sem nome",
        objetivo: ($("#objetivoCampanha").value || "").trim(),
        message_template: $("#mensagemCampanha").value || "Oi, [[nome]]!"
      };

      await disableDuring(async () => {
        const res = await fetch(N8N_OUTREACH, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + session.access_token
          },
          body: JSON.stringify(payload)
        });
        if (!res.ok
